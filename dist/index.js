import{Rome as n,Distribution as m}from"@rometools/js-api";import o from"./options/index.js";import{resolve as p}from"path";import{files as s}from"files-pipeline";import d from"./lib/get-config.js";import i from"files-pipeline/dist/lib/deepmerge.js";var g=(e={})=>{for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&e[t]===!0&&(e[t]=o[t]);e=i(o,e);const r=new Set;if(typeof e.path<"u")if(e.path instanceof Array||e.path instanceof Set)for(const t of e.path)r.add(t);else r.add(e.path);return{name:"astro-rome",hooks:{"astro:build:done":async()=>{const t=await n.create({distribution:m.NODE});(typeof e.rome>"u"||e.rome===null)&&(e.rome=JSON.parse(await d("rome.json"))),e.rome&&e.rome!==!0&&t.applyConfiguration(e.rome);for(const f of r)await(await(await(await new s(e.logger).in(f)).by("**/*.{js,mjs,cjs,ts}")).not(e.exclude)).pipeline(i(o.pipeline,{wrote:async a=>t.formatContent(a.buffer.toString(),{filePath:p(a.inputPath)}).content}))}}}};export{g as default};
