import{Distribution as p,Rome as m}from"@rometools/js-api";import{files as c}from"files-pipe";import s from"files-pipe/dist/lib/deepmerge.js";import{resolve as u}from"path";import d from"./lib/get-config.js";import a from"./options/index.js";var O=(e={})=>{for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&e[o]===!0&&(e[o]=a[o]);const t=s(a,e),r=new Set;if(typeof t.path<"u"&&(t.path instanceof Array||t.path instanceof Set))for(const o of t.path)r.add(o);return{name:"astro-rome",hooks:{"astro:build:done":async({dir:o})=>{try{r.size||r.add(o);const i=await m.create({distribution:p.NODE});(typeof t.rome>"u"||t.rome===null)&&(t.rome=JSON.parse(await d("rome.json"))),t.rome&&t.rome!==!0&&(t.rome.$schema=void 0,i.applyConfiguration(t.rome));for(const f of r)await(await(await(await new c(t.logger).in(f)).by("**/*.{js,mjs,cjs,ts}")).not(t.exclude)).pipe(s(a.pipe,{wrote:async n=>{try{return i.formatContent(n.buffer.toString(),{filePath:u(n.inputPath)}).content}catch{return n.buffer}}}))}catch(i){console.log(i)}}}}};export{O as default};
