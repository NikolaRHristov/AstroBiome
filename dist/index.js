import{Distribution as m,Rome as p}from"@rometools/js-api";import a from"./options/index.js";import{resolve as s}from"path";import{files as c}from"files-pipe";import d from"./lib/get-config.js";import f from"files-pipe/dist/lib/deepmerge.js";var j=(t={})=>{for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&t[e]===!0&&(t[e]=a[e]);t=f(a,t);const r=new Set;if(typeof t.path<"u"&&(t.path instanceof Array||t.path instanceof Set))for(const e of t.path)r.add(e);return{name:"astro-rome",hooks:{"astro:build:done":async({dir:e})=>{try{r.size||r.add(e);const o=await p.create({distribution:m.NODE});(typeof t.rome>"u"||t.rome===null)&&(t.rome=JSON.parse(await d("rome.json"))),t.rome&&t.rome!==!0&&o.applyConfiguration(t.rome);for(const n of r)await(await(await(await new c(t.logger).in(n)).by("**/*.{js,mjs,cjs,ts}")).not(t.exclude)).pipe(f(a.pipe,{wrote:async i=>o.formatContent(i.buffer.toString(),{filePath:s(i.inputPath)}).content}))}catch(o){console.log(o)}}}}};export{j as default};
