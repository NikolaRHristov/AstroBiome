import{Distribution as s,Rome as p}from"@rometools/js-api";import{files as c}from"files-pipe";import f from"files-pipe/dist/lib/deepmerge.js";import{resolve as u}from"path";import d from"./lib/get-config.js";import i from"./options/index.js";var j=(e={})=>{for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&e[t]===!0&&(e[t]=i[t]);e=f(i,e);const r=new Set;if(typeof e.path<"u"&&(e.path instanceof Array||e.path instanceof Set))for(const t of e.path)r.add(t);return{name:"astro-rome",hooks:{"astro:build:done":async({dir:t})=>{try{r.size||r.add(t);const o=await p.create({distribution:s.NODE});(typeof e.rome>"u"||e.rome===null)&&(e.rome=JSON.parse(await d("rome.json"))),e.rome&&e.rome!==!0&&(e.rome.$schema=void 0,o.applyConfiguration(e.rome));for(const n of r)await(await(await(await new c(e.logger).in(n)).by("**/*.{js,mjs,cjs,ts}")).not(e.exclude)).pipe(f(i.pipe,{wrote:async a=>{try{return o.formatContent(a.buffer.toString(),{filePath:u(a.inputPath)}).content}catch(m){return console.log(m),a.buffer}}}))}catch(o){console.log(o)}}}}};export{j as default};
